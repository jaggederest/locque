# Test that modules can reference their own definitions without qualification

import prelude as P
import assert as A

module test_self_ref contains
  # Define a helper function
  define transparent helper as value
    function x of-type Nat produce
      P.add-nat x 10

  # Use the helper without qualification
  define transparent use-helper as value
    function y of-type Nat produce
      helper y

  # Mutual reference case
  define transparent double as value
    function n of-type Nat produce
      P.add-nat n n

  define transparent quadruple as value
    function n of-type Nat produce
      double (double n)

  define transparent main as computation
    bind perform io (A.assert-eq-nat (use-helper 5) 15) as _ then
    bind perform io (A.assert-eq-nat (quadruple 3) 12) as _ then
    return P.tt
end
