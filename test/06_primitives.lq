import Prelude as P
import Assert as A
import Comparison as C
import Arithmetic as Ar
import List as L
import String as S

module PrimitiveTests contains

  define transparent test-comparison as computation
    bind _ <- perform io (A.assert-eq-string (P.if-bool (C.lt-nat 1 2) "yes" "no") "yes") then
    bind _ <- perform io (A.assert-eq-string (P.if-bool (C.gt-nat 2 1) "yes" "no") "yes") then
    bind _ <- perform io (A.assert-eq-string (P.if-bool (C.le-nat 2 2) "yes" "no") "yes") then
    bind _ <- perform io (A.assert-eq-string (P.if-bool (C.ge-nat 3 2) "yes" "no") "yes") then
    bind _ <- perform io (A.assert-eq-string (P.if-bool (C.eq-nat 5 5) "yes" "no") "yes") then
    return P.tt

  define transparent test-arithmetic as computation
    bind _ <- perform io (A.assert-eq-nat (Ar.mul-nat 3 4) 12) then
    bind _ <- perform io (A.assert-eq-nat (Ar.mul-nat 2 5 3) 30) then
    bind _ <- perform io (A.assert-eq-nat (Ar.div-nat 10 3) 3) then
    bind _ <- perform io (A.assert-eq-nat (Ar.mod-nat 10 3) 1) then
    bind _ <- perform io (A.assert-eq-nat (Ar.add-nat 5 10) 15) then
    bind _ <- perform io (A.assert-eq-nat (Ar.sub-nat 10 3) 7) then
    return P.tt

  define transparent test-list-ops as computation
    bind lst <- P.cons "a" (P.cons "b" (P.cons "c" P.nil)) then
    bind _ <- perform io (A.assert-eq-string (L.nth 0 lst) "a") then
    bind _ <- perform io (A.assert-eq-string (L.nth 1 lst) "b") then
    bind _ <- perform io (A.assert-eq-string (L.nth 2 lst) "c") then
    bind taken <- L.take 2 lst then
    bind _ <- perform io (A.assert-eq-nat (P.length-list taken) 2) then
    bind dropped <- L.drop 1 lst then
    bind _ <- perform io (A.assert-eq-nat (P.length-list dropped) 2) then
    bind _ <- perform io (A.assert-eq-string (L.nth 0 dropped) "b") then
    return P.tt

  define transparent test-string-ops as computation
    bind _ <- perform io (A.assert-eq-string (S.substring 0 3 "hello") "hel") then
    bind _ <- perform io (A.assert-eq-string (S.substring 2 3 "hello") "llo") then
    bind _ <- perform io (A.assert-eq-string (S.char-at 1 "hello") "e") then
    bind _ <- perform io (A.assert-eq-string (S.char-at 0 "hello") "h") then
    bind _ <- perform io (A.assert-eq-string (P.if-bool (S.string-contains "ell" "hello") "yes" "no") "yes") then
    bind _ <- perform io (A.assert-eq-string (P.if-bool (S.string-contains "xyz" "hello") "yes" "no") "no") then
    bind _ <- perform io (A.assert-eq-string (P.if-bool (S.string-starts-with "hel" "hello") "yes" "no") "yes") then
    bind _ <- perform io (A.assert-eq-string (P.if-bool (S.string-starts-with "llo" "hello") "yes" "no") "no") then
    return P.tt

  define transparent main as computation
    bind _ <- test-comparison then
    bind _ <- test-arithmetic then
    bind _ <- test-list-ops then
    bind _ <- test-string-ops then
    return P.tt
end
