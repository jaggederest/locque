# Minimal prelude tests using the current surface syntax

import prelude as P
import assert as A
import io as IO
import string as S

module test::prelude::basics contains
  define transparent add2 as
    function x Natural returns Natural value
      P::add-nat x 2
    end

  define transparent hello as compute
    bind ignored from perform (IO::print "Hello, locque!") then
      return tt
    end
  end

  define transparent check-arithmetic as compute
    bind ignored from perform (A::assert-eq-nat (add2 3) 5) then
      return tt
    end
  end

  define transparent check-string as compute
    bind ignored from perform (A::assert-eq-string (S::join-with "-" (S::split-on "-" "a-b")) "a-b") then
      return tt
    end
  end

  define transparent check-match as compute
    bind ignored from perform (A::assert-eq-nat
      (match true of-type Boolean
        false-case as 0
        true-case as 1
      end)
      1) then
      return tt
    end
  end

  define transparent check-let as compute
    bind ignored from perform (A::assert-eq-nat
      (let value x be 4 in
        P::add-nat x 1
      end)
      5) then
      return tt
    end
  end

  define transparent main as compute
    bind ignored from perform hello then
      bind ignored from perform check-arithmetic then
        bind ignored from perform check-string then
          bind ignored from perform check-match then
            bind ignored from perform check-let then
              return tt
            end
          end
        end
      end
    end
  end
end
