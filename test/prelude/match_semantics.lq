# Migrated from ../13_match_semantics.lq

import prelude as P
import assert as A

module test::prelude::match_semantics contains
  define transparent test-list-empty as compute
    bind result from return
      (match (P::nil String) of-type (List String) as ignored returns String
        case List::empty as "empty"
        case List::cons with h String t (List String) as "cons"
      end)
    then
      sequence
        (A::assert-eq String result "empty")
      end
    end
  end

  define transparent test-list-cons as compute
    bind result from return
      (match (P::cons String "first" (P::cons String "second" (P::nil String)))
        of-type (List String) as ignored returns String
        case List::empty as "empty"
        case List::cons with h String t (List String) as h
      end)
    then
      sequence
        (A::assert-eq String result "first")
      end
    end
  end

  define transparent test-bool-false as compute
    bind result from return
      (match false of-type Boolean as ignored returns String
        case Boolean::false as "false-branch"
        case Boolean::true as "true-branch"
      end)
    then
      sequence
        (A::assert-eq String result "false-branch")
      end
    end
  end

  define transparent test-bool-true as compute
    bind result from return
      (match true of-type Boolean as ignored returns String
        case Boolean::false as "false-branch"
        case Boolean::true as "true-branch"
      end)
    then
      sequence
        (A::assert-eq String result "true-branch")
      end
    end
  end

  define transparent test-pair as compute
    bind result from return
      (match (P::pair String String "left" "right") of-type (Pair String String) as ignored returns String
        case Pair::pair with a String b String as a
      end)
    then
      sequence
        (A::assert-eq String result "left")
      end
    end
  end

  define transparent main as compute
    sequence
      test-list-empty
      test-list-cons
      test-bool-false
      test-bool-true
      test-pair
    end
  end
end
