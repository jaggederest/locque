# Tests for Equality typeclass
# NOTE: Multi-arg typeclass methods are curried; application is left-associative.
import assert as A
import prelude as P
import typeclass::equality as Eq
import string as S

open Eq exposing Equality eq end

module test::typeclass::equality contains

  # Generic equality with constraint
  define transparent eq-value as
    function A Type0 x A y A requires Equality A returns Boolean value
      eq x y
    end

  # Derived: not equal (for Natural)
  define transparent neq as
    function x Natural y Natural returns Boolean value
      P::not (eq-value Natural x y)
    end

  # Test values for Natural equality
  define transparent test-nat-eq-same as eq-value Natural 42 42
  define transparent test-nat-eq-diff as eq-value Natural 42 43

  # Test values for String equality
  define transparent test-str-eq-same as eq-value String "hello" "hello"
  define transparent test-str-eq-diff as eq-value String "hello" "world"

  # Test values for Boolean equality
  define transparent test-bool-eq-tt as eq-value Boolean true true
  define transparent test-bool-eq-ff as eq-value Boolean false false
  define transparent test-bool-eq-tf as eq-value Boolean true false
  define transparent test-bool-eq-ft as eq-value Boolean false true

  # Test with variables (ETyped)
  define transparent test-nat-eq-var as
    function x Natural returns Boolean value
      eq-value Natural x x
    end

  define transparent test-str-eq-var as
    function s String returns Boolean value
      eq-value String s s
    end

  define transparent test-bool-eq-var as
    function b Boolean returns Boolean value
      eq-value Boolean b b
    end

  # Test neq
  define transparent test-neq-same as neq 5 5
  define transparent test-neq-diff as neq 5 10

  define transparent main as compute
    perform (P::sequence-unit
      [
        (A::assert-eq Boolean test-nat-eq-same true)
      , (A::assert-eq Boolean test-nat-eq-diff false)
      , (A::assert-eq Boolean test-str-eq-same true)
      , (A::assert-eq Boolean test-str-eq-diff false)
      , (A::assert-eq Boolean test-bool-eq-tt true)
      , (A::assert-eq Boolean test-bool-eq-ff true)
      , (A::assert-eq Boolean test-bool-eq-tf false)
      , (A::assert-eq Boolean test-bool-eq-ft false)
      , (A::assert-eq Boolean (test-nat-eq-var 99) true)
      , (A::assert-eq Boolean (test-str-eq-var "test") true)
      , (A::assert-eq Boolean (test-bool-eq-var true) true)
      , (A::assert-eq Boolean (test-bool-eq-var false) true)
      , (A::assert-eq Boolean test-neq-same false)
      , (A::assert-eq Boolean test-neq-diff true)
      ])
  end
end
