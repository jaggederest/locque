# Tests for Order typeclasses
# NOTE: Multi-arg typeclass methods are curried; application is left-associative.
import assert as A
import prelude as P

module test::typeclass::order contains
  # Less-than typeclass
  define transparent LessThan as typeclass A where
    lt of-type for-all x as A to for-all y as A to Boolean
  end

  define transparent LessThan-Natural as instance LessThan Natural where
    lt as function x Natural y Natural returns Boolean value
      lt-nat-prim x y
    end
  end

  define transparent LessThan-Boolean as instance LessThan Boolean where
    lt as function x Boolean y Boolean returns Boolean value
      P::if-bool Boolean x false y
    end
  end

  # Less-than-or-equal typeclass
  define transparent LessOrEqual as typeclass A where
    le of-type for-all x as A to for-all y as A to Boolean
  end

  define transparent LessOrEqual-Natural as instance LessOrEqual Natural where
    le as function x Natural y Natural returns Boolean value
      le-nat-prim x y
    end
  end

  define transparent LessOrEqual-Boolean as instance LessOrEqual Boolean where
    le as function x Boolean y Boolean returns Boolean value
      P::if-bool Boolean x y true
    end
  end

  # Greater-than typeclass
  define transparent GreaterThan as typeclass A where
    gt of-type for-all x as A to for-all y as A to Boolean
  end

  define transparent GreaterThan-Natural as instance GreaterThan Natural where
    gt as function x Natural y Natural returns Boolean value
      gt-nat-prim x y
    end
  end

  define transparent GreaterThan-Boolean as instance GreaterThan Boolean where
    gt as function x Boolean y Boolean returns Boolean value
      P::if-bool Boolean x (not-prim y) false
    end
  end

  # Greater-than-or-equal typeclass
  define transparent GreaterOrEqual as typeclass A where
    ge of-type for-all x as A to for-all y as A to Boolean
  end

  define transparent GreaterOrEqual-Natural as instance GreaterOrEqual Natural where
    ge as function x Natural y Natural returns Boolean value
      ge-nat-prim x y
    end
  end

  define transparent GreaterOrEqual-Boolean as instance GreaterOrEqual Boolean where
    ge as function x Boolean y Boolean returns Boolean value
      P::if-bool Boolean x true (not-prim y)
    end
  end

  # Generic helpers with constraints
  define transparent lt-value as
    function A Type0 x A y A requires LessThan A returns Boolean value
      lt x y
    end

  define transparent le-value as
    function A Type0 x A y A requires LessOrEqual A returns Boolean value
      le x y
    end

  define transparent gt-value as
    function A Type0 x A y A requires GreaterThan A returns Boolean value
      gt x y
    end

  define transparent ge-value as
    function A Type0 x A y A requires GreaterOrEqual A returns Boolean value
      ge x y
    end

  # Test Natural lt
  define transparent test-nat-lt-yes as lt-value Natural 5 10
  define transparent test-nat-lt-no as lt-value Natural 10 5
  define transparent test-nat-lt-eq as lt-value Natural 5 5

  # Test Natural le
  define transparent test-nat-le-yes as le-value Natural 5 10
  define transparent test-nat-le-eq as le-value Natural 5 5
  define transparent test-nat-le-no as le-value Natural 10 5

  # Test Natural gt
  define transparent test-nat-gt-yes as gt-value Natural 10 5
  define transparent test-nat-gt-no as gt-value Natural 5 10
  define transparent test-nat-gt-eq as gt-value Natural 5 5

  # Test Natural ge
  define transparent test-nat-ge-yes as ge-value Natural 10 5
  define transparent test-nat-ge-eq as ge-value Natural 5 5
  define transparent test-nat-ge-no as ge-value Natural 5 10

  # Test Boolean ordering (false < true)
  define transparent test-bool-lt-ff as lt-value Boolean false false
  define transparent test-bool-lt-ft as lt-value Boolean false true
  define transparent test-bool-lt-tf as lt-value Boolean true false
  define transparent test-bool-lt-tt as lt-value Boolean true true

  define transparent test-bool-le-ff as le-value Boolean false false
  define transparent test-bool-le-ft as le-value Boolean false true
  define transparent test-bool-le-tf as le-value Boolean true false
  define transparent test-bool-le-tt as le-value Boolean true true

  # Test with variables (ETyped)
  define transparent test-nat-lt-var as
    function x Natural y Natural returns Boolean value
      lt-value Natural x y
    end

  define transparent main as compute
    sequence
      (A::assert-eq-bool test-nat-lt-yes true)
      (A::assert-eq-bool test-nat-lt-no false)
      (A::assert-eq-bool test-nat-lt-eq false)
      (A::assert-eq-bool test-nat-le-yes true)
      (A::assert-eq-bool test-nat-le-eq true)
      (A::assert-eq-bool test-nat-le-no false)
      (A::assert-eq-bool test-nat-gt-yes true)
      (A::assert-eq-bool test-nat-gt-no false)
      (A::assert-eq-bool test-nat-gt-eq false)
      (A::assert-eq-bool test-nat-ge-yes true)
      (A::assert-eq-bool test-nat-ge-eq true)
      (A::assert-eq-bool test-nat-ge-no false)
      (A::assert-eq-bool test-bool-lt-ff false)
      (A::assert-eq-bool test-bool-lt-ft true)
      (A::assert-eq-bool test-bool-lt-tf false)
      (A::assert-eq-bool test-bool-lt-tt false)
      (A::assert-eq-bool test-bool-le-ff true)
      (A::assert-eq-bool test-bool-le-ft true)
      (A::assert-eq-bool test-bool-le-tf false)
      (A::assert-eq-bool test-bool-le-tt true)
      (A::assert-eq-bool (test-nat-lt-var 3 7) true)
      (A::assert-eq-bool (test-nat-lt-var 7 3) false)
    end
  end
end
