(import Tools::MexprToSexpr Conv)
(import Assert A)
(import Prelude P)

(module MexprToSexprTests
  (def transparent sample (value "module Hello contains define transparent message as value \"hi\" end"))
  (def transparent empty-sample (value "module Empty contains end"))

  (def transparent check-convert
    (computation
      (do
        (bind out (Conv.convert-string sample))
        (bind _ (perform io (A.assert-eq-string out "(module Hello (def transparent message (value \"hi\")))")))
        (return P.tt))))

  (def transparent check-empty
    (computation
      (do
        (bind out (Conv.convert-string empty-sample))
        (bind _ (perform io (A.assert-eq-string out "(module Empty)")))
        (return P.tt))))

  (def transparent main
    (computation
      (do
        (bind _ check-convert)
        (bind _ check-empty)
        (return P.tt)))))
